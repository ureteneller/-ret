<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ä°lan OluÅŸtur â€¢ Ãœreten Eller</title>
  <meta name="description" content="Ãœreten Eller'de ilan oluÅŸturun. Ã‡ok dilli arayÃ¼z: TR/EN/AR/DE. FotoÄŸraf Ã¶nizleme, kapak seÃ§imi ve silme desteklenir." />
  <link rel="icon" href="/assets/icons/favicon.png" />

  <!-- === LOGIN GUARD (oturum yoksa giriÅŸe) === -->
  <script>
    (function(){
      function goLogin(){
        var next = location.pathname;
        try {
          // EÄŸer query varsa aynen taÅŸÄ±
          if (location.search) next += location.search;
          if (location.hash)   next += location.hash;
        } catch(_) {}
        location.replace('/giris.html?next=' + encodeURIComponent(next));
      }

      // HÄ±zlÄ± kontrol: localStorage ue_user yoksa doÄŸrudan
      var hasLocal = false;
      try { hasLocal = !!localStorage.getItem('ue_user'); } catch(_){}

      // Firebase hazÄ±r olduÄŸunda da doÄŸrula (geri kapÄ±)
      document.addEventListener('fb-ready', function(){
        try{
          var fb = window.firebase || self.firebase;
          if (fb && fb.getAuth) {
            var auth = fb.getAuth(self.__fb && self.__fb.app);
            var unsub = fb.onAuthStateChanged(auth, function(user){
              if(!user) goLogin();
              if (typeof unsub === 'function') unsub();
            }, function(){ goLogin(); });
            // Ekstra emniyet: kÄ±sa bir sÃ¼re sonra hala user yoksa
            setTimeout(function(){ if(!auth || !auth.currentUser) goLogin(); }, 1200);
          } else {
            if(!hasLocal) goLogin();
          }
        } catch(_){
          if(!hasLocal) goLogin();
        }
      }, { once:true });

      // Firebase yÃ¼klenmezse bile koru
      setTimeout(function(){
        if(!hasLocal) goLogin();
      }, 800);
    })();
  </script>

  <style>
    /* ===== AÃ§Ä±k Tema (beyaz zemin) ===== */
    :root{
      --ink:#0b1220;
      --muted:#6b7280;
      --brd:#e5e7eb;
      --card:#ffffff;
      --ok:#10b981;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:#ffffff;
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
    }

    .wrap{max-width:960px;margin:24px auto;padding:16px}
    .card{
      background:var(--card);
      border:1px solid var(--brd);
      border-radius:18px;
      padding:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.06);
    }
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}

    label{display:block;font-size:13px;color:var(--muted);margin:6px 0}
    input,select,textarea{
      width:100%;
      background:#fff;
      color:var(--ink);
      border:1px solid var(--brd);
      border-radius:12px;
      padding:10px 12px;
    }
    textarea{min-height:120px;resize:vertical}

    /* Ã–nizleme kartlarÄ± */
    .previews{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;margin-top:10px}
    .thumb{position:relative;border:1px solid var(--brd);border-radius:10px;overflow:hidden;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6px}
    .thumb img{width:100%;height:auto;max-height:220px;object-fit:contain;display:block;border-radius:8px;margin-bottom:6px}
    .thumb .btns{display:flex;gap:6px;justify-content:center;margin-bottom:4px}
    .thumb button{background:rgba(0,0,0,.7);color:#fff;border:none;padding:4px 8px;font-size:12px;border-radius:6px;cursor:pointer}
    .thumb .cover{position:absolute;top:6px;left:6px;background:#10b981;color:#03222a;font-size:12px;padding:2px 6px;border-radius:8px;font-weight:700}

    /* Butonlar */
    .actions{display:flex;gap:8px;justify-content:flex-end}

    .btn{cursor:pointer;border:1px solid var(--brd);background:#fff;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:800}
    .btn:active{transform:translateY(1px)}
    .btn.gold{
      color:#111;
      background:linear-gradient(180deg,#f7e7b5,#e8c972 40%,#d7b45d 55%,#caa552 80%,#b79343);
      border:1px solid #b18a37;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.7),0 4px 18px rgba(202,165,82,.25);
    }

    /* Mevcut buton sÄ±nÄ±flarÄ±nÄ± koruyup goldâ€™a yÃ¶nlendir */
    button.primary{ all:unset; }
    button.primary{ cursor:pointer; display:inline-block; padding:10px 14px; border-radius:12px; font-weight:800; }
    button.primary{ color:#111; background:linear-gradient(180deg,#f7e7b5,#e8c972 40%,#d7b45d 55%,#caa552 80%,#b79343); border:1px solid #b18a37; box-shadow:inset 0 1px 0 rgba(255,255,255,.7),0 4px 18px rgba(202,165,82,.25); }

    .hint{font-size:12px;color:var(--muted)}
    .closeX{
      background:#111;color:#fff;border:none;width:36px;height:36px;border-radius:999px;
      font-size:20px;line-height:36px;text-align:center;cursor:pointer;box-shadow:0 4px 16px rgba(0,0,0,.15)
    }

    /* Form grid */
    form#listingForm{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
    .full{grid-column:1/-1}

    /* Mobil uyum: 1 sÃ¼tun */
    @media (max-width: 720px){
      form#listingForm{grid-template-columns:1fr}
      .topbar{align-items:flex-start;gap:8px}
    }

    /* Toast (aÃ§Ä±k tema) */
    #toast{
      position:fixed;left:50%;top:20px;transform:translateX(-50%) scale(0.95);opacity:0;transition:.25s;z-index:9999;
      background:#111;color:#fff;border:1px solid #111;padding:10px 14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.2);
    }
  </style>
  
  <!-- Firestore iÃ§in global yardÄ±mcÄ±larÄ± saÄŸlayan dosya -->
  <script type="module" src="/firebase-init.js"></script>

  <!-- >>> BURAYA YAPIÅTIR <<< -->
  <script type="module">
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';

    (function protectPage(){
      try{
        const auth = getAuth(self.__fb?.app);
        onAuthStateChanged(auth, async (user) => {
          if (!user) { location.replace('/index.html'); return; }
          const usesPassword = user.providerData?.some(p => p.providerId === 'password');
          try { await user.reload(); } catch(_) {}
          if (usesPassword && !user.emailVerified) { location.replace('/index.html'); return; }
        });
      }catch(e){
        console.warn('protectPage hata', e);
        try{ location.replace('/index.html'); }catch(_){}
      }
    })();
  </script>
</head>

<body>
   <script>
    // GiriÅŸ yapÄ±lmamÄ±ÅŸsa index.html'e yÃ¶nlendir
    if (!localStorage.getItem('ue_user')) {
      location.replace('/index.html');
    }
  </script>

  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <h1 id="t_title">Ä°lan OluÅŸtur</h1>
          <p class="hint" id="t_sub">PREMIUM: <strong>10 ilan</strong>. FREE: <strong>5 ilan</strong>. TÃ¼m ilanlar <strong>30 gÃ¼n</strong> yayÄ±nda.</p>
        </div>
        <div class="lang">
          <label id="t_lang" for="langSel">Dil</label>
          <select id="langSel">
  <option value="tr">TÃ¼rkÃ§e</option>
  <option value="en">English</option>
  <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
  <option value="de">Deutsch</option>
  <option value="az">AzÉ™rbaycan dili</option>
  <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
</select>
        </div>
        <button id="closeBtn" class="closeX" aria-label="Kapat">Ã—</button>
      </div>

      <form id="listingForm" novalidate>
        <div class="full">
          <label id="l_title">BaÅŸlÄ±k</label>
          <input id="title" required placeholder="Ã–rn: El yapÄ±mÄ± Ã¶rgÃ¼ bebek" maxlength="80" />
          <div class="hint" id="h_title">6â€“80 karakter</div>
        </div>
        <div class="full">
          <label id="l_description">AÃ§Ä±klama</label>
          <textarea id="description" required placeholder="ÃœrÃ¼nÃ¼ detaylÄ± anlatÄ±n" maxlength="3000"></textarea>
          <div class="hint" id="h_description">30â€“3000 karakter, uygunsuz iÃ§erik reddedilir.</div>
        </div>

        <div>
          <label id="l_category">Kategori</label>
          <select id="category" required></select>
        </div>
        <div>
          <label id="l_subcategory">Alt Kategori</label>
          <select id="subcategory" required disabled></select>
        </div>

                <div>
          <label id="l_country">Ãœlke</label>
          <select id="country" required>
            <option value="TR">TÃ¼rkiye</option>
            <option value="DE">Almanya</option>
            <option value="CY">KÄ±brÄ±s</option>
            <option value="AZ">Azerbaycan</option>
            <option value="IR">Ä°ran</option>
          </select>
        </div>
        <div>
          <label id="l_province">Ä°l / BÃ¶lge</label>
          <select id="province" required></select>
        </div>
        <div>
          <label id="l_district">Ä°lÃ§e</label>
          <input id="districtInput" required placeholder="Ä°lÃ§enizi yazÄ±n" />
        </div>

        <div>
          <label id="l_price">Fiyat (TL)</label>
          <input id="price" type="number" min="1" step="1" placeholder="Ã–rn: 350" required />
        </div>
        <div>
          <label id="l_stock">Stok</label>
          <select id="stock" required>
            <option value="var">Var</option>
            <option value="yok">Yok</option>
          </select>
        </div>

        <div class="full">
          <label id="l_images">FotoÄŸraflar (en fazla 5)</label>
          <input id="images" type="file" accept="image/*" multiple />
          <div id="previews" class="previews"></div>
        </div>

        <div class="full actions">
          <button type="reset" id="b_cancel" class="btn">Ä°ptal</button>
          <button type="submit" class="primary" id="b_submit">Kaydet</button>
        </div>

        <div class="full">
          <div id="msg" class="hint"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast">YÃ¶netici onayÄ±ndan sonra yayÄ±nlanacaktÄ±r.</div>

  <!-- i18n + Ã¶nizleme (deÄŸiÅŸtirilmedi; sadece closeBtn hedefi index.html yapÄ±ldÄ±) -->
  <script>
  (function(){
    'use strict';
    /* â€”â€”â€” mevcut i18n ve yardÄ±mcÄ±lar aynen â€”â€”â€” */

    const i18n = {
  tr: {
    title: "Ä°lan OluÅŸtur",
    sub: 'PREMIUM: <strong>10 ilan</strong>. FREE: <strong>5 ilan</strong>. TÃ¼m ilanlar <strong>30 gÃ¼n</strong> yayÄ±nda.',
    lang: "Dil",
    l_title: "BaÅŸlÄ±k",
    h_title: "6â€“80 karakter",
    l_description: "AÃ§Ä±klama",
    h_description: "30â€“3000 karakter, uygunsuz iÃ§erik reddedilir.",
    l_category: "Kategori",
    l_subcategory: "Alt Kategori",
    l_country: "Ãœlke",
    l_province: "Ä°l / BÃ¶lge",
    l_district: "Ä°lÃ§e",
    l_price: "Fiyat (TL)",
    l_stock: "Stok",
    l_images: "FotoÄŸraflar (en fazla 5)",
    btn_cancel: "Ä°ptal",
    btn_submit: "Kaydet",
    placeholders: {
      title: "Ã–rn: El yapÄ±mÄ± Ã¶rgÃ¼ bebek",
      desc: "ÃœrÃ¼nÃ¼ detaylÄ± anlatÄ±n",
      district: "Ä°lÃ§enizi yazÄ±n",
      price: "Ã–rn: 350"
    },
    stock: { var: "Var", yok: "Yok" },
    toast_ok: "Ä°lanÄ±nÄ±z kaydedildi. YÃ¶netici onayÄ±ndan sonra yayÄ±nlanacaktÄ±r.",
    cover: "Kapak",
    coverMake: "Kapak yap",
    del: "Sil",
    choose: "SeÃ§iniz",
    errors: {
      auth: "LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n.",
      title: "BaÅŸlÄ±k Ã§ok kÄ±sa. (min. 6 karakter)",
      desc: "AÃ§Ä±klama Ã§ok kÄ±sa. (min. 30 karakter)",
      cat: "LÃ¼tfen bir kategori seÃ§in.",
      sub: "LÃ¼tfen bir alt kategori seÃ§in.",
      prov: "LÃ¼tfen Ã¼lke ve il/bÃ¶lge seÃ§in.",
      dist: "LÃ¼tfen ilÃ§e bilgisini girin.",
      price: "Fiyat en az 1 TL olmalÄ±dÄ±r.",
      files: "En fazla 5 fotoÄŸraf yÃ¼kleyebilirsiniz.",
      filetype: "Sadece JPG, PNG veya WebP formatÄ±nda fotoÄŸraf yÃ¼kleyin."
    }
  },

  en: {
    title: "Create Listing",
    sub: 'PREMIUM: <strong>10 listings</strong>. FREE: <strong>5 listings</strong>. All listings stay online for <strong>30 days</strong>.',
    lang: "Language",
    l_title: "Title",
    h_title: "6â€“80 characters",
    l_description: "Description",
    h_description: "30â€“3000 characters, inappropriate content will be rejected.",
    l_category: "Category",
    l_subcategory: "Subcategory",
    l_country: "Country",
    l_province: "Province / Region",
    l_district: "District",
    l_price: "Price (TRY)",
    l_stock: "Stock",
    l_images: "Photos (max. 5)",
    btn_cancel: "Cancel",
    btn_submit: "Save",
    placeholders: {
      title: "e.g. Handmade knitted doll",
      desc: "Describe your product in detail",
      district: "Type your district",
      price: "e.g. 350"
    },
    stock: { var: "In stock", yok: "Out of stock" },
    toast_ok: "Your listing has been saved. It will be published after admin approval.",
    cover: "Cover",
    coverMake: "Make cover",
    del: "Delete",
    choose: "Select",
    errors: {
      auth: "Please sign in first.",
      title: "Title is too short. (min. 6 characters)",
      desc: "Description is too short. (min. 30 characters)",
      cat: "Please select a category.",
      sub: "Please select a subcategory.",
      prov: "Please select a country and province/region.",
      dist: "Please enter your district.",
      price: "Price must be at least 1 TRY.",
      files: "You can upload up to 5 photos.",
      filetype: "Please upload only JPG, PNG or WebP images."
    }
  },

  de: {
    title: "Anzeige erstellen",
    sub: 'PREMIUM: <strong>10 Anzeigen</strong>. FREE: <strong>5 Anzeigen</strong>. Alle Anzeigen bleiben <strong>30 Tage</strong> online.',
    lang: "Sprache",
    l_title: "Titel",
    h_title: "6â€“80 Zeichen",
    l_description: "Beschreibung",
    h_description: "30â€“3000 Zeichen, unzulÃ¤ssige Inhalte werden abgelehnt.",
    l_category: "Kategorie",
    l_subcategory: "Unterkategorie",
    l_country: "Land",
    l_province: "Bundesland / Region",
    l_district: "Bezirk",
    l_price: "Preis (TRY)",
    l_stock: "Bestand",
    l_images: "Fotos (max. 5)",
    btn_cancel: "Abbrechen",
    btn_submit: "Speichern",
    placeholders: {
      title: "z.B. Handgemachte Strickpuppe",
      desc: "Beschreiben Sie Ihr Produkt ausfÃ¼hrlich",
      district: "Bezirk eingeben",
      price: "z.B. 350"
    },
    stock: { var: "VerfÃ¼gbar", yok: "Nicht verfÃ¼gbar" },
    toast_ok: "Ihre Anzeige wurde gespeichert. Sie wird nach Freigabe durch den Admin verÃ¶ffentlicht.",
    cover: "Titelbild",
    coverMake: "Als Titelbild",
    del: "LÃ¶schen",
    choose: "Bitte wÃ¤hlen",
    errors: {
      auth: "Bitte melden Sie sich zuerst an.",
      title: "Der Titel ist zu kurz. (mind. 6 Zeichen)",
      desc: "Die Beschreibung ist zu kurz. (mind. 30 Zeichen)",
      cat: "Bitte wÃ¤hlen Sie eine Kategorie.",
      sub: "Bitte wÃ¤hlen Sie eine Unterkategorie.",
      prov: "Bitte wÃ¤hlen Sie ein Land und ein Bundesland/Region.",
      dist: "Bitte geben Sie Ihren Bezirk ein.",
      price: "Der Preis muss mindestens 1 TRY betragen.",
      files: "Sie kÃ¶nnen bis zu 5 Fotos hochladen.",
      filetype: "Bitte nur Bilder im Format JPG, PNG oder WebP hochladen."
    }
  },

  az: {
    title: "Elan Yarat",
    sub: 'PREMÄ°UM: <strong>10 elan</strong>. FREE: <strong>5 elan</strong>. BÃ¼tÃ¼n elanlar <strong>30 gÃ¼n</strong> aktiv qalÄ±r.',
    lang: "Dil",
    l_title: "BaÅŸlÄ±q",
    h_title: "6â€“80 simvol",
    l_description: "AÃ§Ä±qlama",
    h_description: "30â€“3000 simvol, uyÄŸun olmayan mÉ™zmun qÉ™bul edilmir.",
    l_category: "Kateqoriya",
    l_subcategory: "Alt kateqoriya",
    l_country: "Ã–lkÉ™",
    l_province: "VilayÉ™t / Region",
    l_district: "Rayon",
    l_price: "QiymÉ™t (TL)",
    l_stock: "Anbar",
    l_images: "ÅÉ™killÉ™r (maks. 5)",
    btn_cancel: "LÉ™ÄŸv et",
    btn_submit: "Yadda saxla",
    placeholders: {
      title: "MÉ™s: Æl iÅŸi toxunma oyuncaÄŸÄ±",
      desc: "MÉ™hsulu É™traflÄ± tÉ™svir edin",
      district: "Rayonunuzu yazÄ±n",
      price: "MÉ™s: 350"
    },
    stock: { var: "Var", yok: "Yox" },
    toast_ok: "ElanÄ±nÄ±z yadda saxlanÄ±ldÄ±. Admin tÉ™sdiqindÉ™n sonra dÉ™rc olunacaq.",
    cover: "Qapaq",
    coverMake: "Qapaq et",
    del: "Sil",
    choose: "SeÃ§in",
    errors: {
      auth: "ZÉ™hmÉ™t olmasa É™vvÉ™lcÉ™ daxil olun.",
      title: "BaÅŸlÄ±q Ã§ox qÄ±sadÄ±r. (min. 6 simvol)",
      desc: "AÃ§Ä±qlama Ã§ox qÄ±sadÄ±r. (min. 30 simvol)",
      cat: "ZÉ™hmÉ™t olmasa kateqoriya seÃ§in.",
      sub: "ZÉ™hmÉ™t olmasa alt kateqoriya seÃ§in.",
      prov: "ZÉ™hmÉ™t olmasa Ã¶lkÉ™ vÉ™ vilayÉ™t/region seÃ§in.",
      dist: "ZÉ™hmÉ™t olmasa rayonunuzu yazÄ±n.",
      price: "QiymÉ™t É™n azÄ± 1 TL olmalÄ±dÄ±r.",
      files: "Æn Ã§ox 5 ÅŸÉ™kil yÃ¼klÉ™yÉ™ bilÉ™rsiniz.",
      filetype: "YalnÄ±z JPG, PNG vÉ™ ya WebP ÅŸÉ™killÉ™ri yÃ¼klÉ™yin."
    }
  },

  ar: {
    title: "Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù†",
    sub: 'Ø¨Ø§Ù‚Ø§Øª PREMIUM: <strong>10 Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong>. Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©: <strong>5 Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong>. ØªØ¨Ù‚Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª <strong>30 ÙŠÙˆÙ…Ø§Ù‹</strong> Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.',
    lang: "Ø§Ù„Ù„ØºØ©",
    l_title: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    h_title: "6â€“80 Ø­Ø±ÙØ§Ù‹",
    l_description: "Ø§Ù„ÙˆØµÙ",
    h_description: "Ù…Ù† 30 Ø¥Ù„Ù‰ 3000 Ø­Ø±ÙØŒ Ø³ÙŠØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ø§Ù„Ù„Ø§Ø¦Ù‚.",
    l_category: "Ø§Ù„ÙØ¦Ø©",
    l_subcategory: "Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©",
    l_country: "Ø§Ù„Ø¯ÙˆÙ„Ø©",
    l_province: "Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
    l_district: "Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù‚Ø¶Ø§Ø¡",
    l_price: "Ø§Ù„Ø³Ø¹Ø± (Ù„ÙŠØ±Ø© ØªØ±ÙƒÙŠØ©)",
    l_stock: "Ø§Ù„ØªÙˆÙØ±",
    l_images: "Ø§Ù„ØµÙˆØ± (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5)",
    btn_cancel: "Ø¥Ù„ØºØ§Ø¡",
    btn_submit: "Ø­ÙØ¸",
    placeholders: {
      title: "Ù…Ø«Ø§Ù„: Ø¯Ù…ÙŠØ© Ù…Ø­Ø§ÙƒØ© ÙŠØ¯ÙˆÙŠØ§Ù‹",
      desc: "Ø§Ø´Ø±Ø­ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ØªÙØµÙŠÙ„",
      district: "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù‚Ø¶Ø§Ø¡",
      price: "Ù…Ø«Ø§Ù„: 350"
    },
    stock: { var: "Ù…ØªÙˆÙØ±", yok: "ØºÙŠØ± Ù…ØªÙˆÙØ±" },
    toast_ok: "ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ù„Ø§Ù†Ùƒ. Ø³ÙŠØªÙ… Ù†Ø´Ø±Ù‡ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.",
    cover: "ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù",
    coverMake: "ØªØ¹ÙŠÙŠÙ† ÙƒØºÙ„Ø§Ù",
    del: "Ø­Ø°Ù",
    choose: "Ø§Ø®ØªØ±",
    errors: {
      auth: "ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.",
      title: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 6 Ø£Ø­Ø±Ù).",
      desc: "Ø§Ù„ÙˆØµÙ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 30 Ø­Ø±ÙØ§Ù‹).",
      cat: "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø©.",
      sub: "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©.",
      prov: "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø©/Ø§Ù„Ù…Ù†Ø·Ù‚Ø©.",
      dist: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù‚Ø¶Ø§Ø¡.",
      price: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¹Ø± 1 Ù„ÙŠØ±Ø© ØªØ±ÙƒÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.",
      files: "ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ù…Ø§ ÙŠØµÙ„ Ø¥Ù„Ù‰ 5 ØµÙˆØ±.",
      filetype: "ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ± Ø¨ØµÙŠØºØ© JPG Ø£Ùˆ PNG Ø£Ùˆ WebP ÙÙ‚Ø·."
    }
  },

  fa: {
    title: "Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ú¯Ù‡ÛŒ",
    sub: 'Ø·Ø±Ø­ PREMIUM: <strong>10 Ø¢Ú¯Ù‡ÛŒ</strong>. Ø·Ø±Ø­ Ø±Ø§ÛŒÚ¯Ø§Ù†: <strong>5 Ø¢Ú¯Ù‡ÛŒ</strong>. Ù‡Ù…Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ Ù…Ø¯Øª <strong>30 Ø±ÙˆØ²</strong> ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯.',
    lang: "Ø²Ø¨Ø§Ù†",
    l_title: "Ø¹Ù†ÙˆØ§Ù†",
    h_title: "Û¶ ØªØ§ Û¸Û° Ú©Ø§Ø±Ø§Ú©ØªØ±",
    l_description: "ØªÙˆØ¶ÛŒØ­Ø§Øª",
    h_description: "Û³Û° ØªØ§ Û³Û°Û°Û° Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
    l_category: "Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",
    l_subcategory: "Ø²ÛŒØ± Ø¯Ø³ØªÙ‡",
    l_country: "Ú©Ø´ÙˆØ±",
    l_province: "Ø§Ø³ØªØ§Ù† / Ù…Ù†Ø·Ù‚Ù‡",
    l_district: "Ø´Ù‡Ø± / Ù†Ø§Ø­ÛŒÙ‡",
    l_price: "Ù‚ÛŒÙ…Øª (Ù„ÛŒØ± ØªØ±Ú©ÛŒÙ‡)",
    l_stock: "Ù…ÙˆØ¬ÙˆØ¯ÛŒ",
    l_images: "ØªØµØ§ÙˆÛŒØ± (Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ø¹Ø¯Ø¯)",
    btn_cancel: "Ø§Ù†ØµØ±Ø§Ù",
    btn_submit: "Ø°Ø®ÛŒØ±Ù‡",
    placeholders: {
      title: "Ù…Ø«Ø§Ù„: Ø¹Ø±ÙˆØ³Ú© Ø¨Ø§ÙØªÙ†ÛŒ Ø¯Ø³Øªâ€ŒØ³Ø§Ø²",
      desc: "Ù…Ø­ØµÙˆÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯",
      district: "Ø´Ù‡Ø± ÛŒØ§ Ù†Ø§Ø­ÛŒÙ‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
      price: "Ù…Ø«Ø§Ù„: Û³ÛµÛ°"
    },
    stock: { var: "Ù…ÙˆØ¬ÙˆØ¯", yok: "Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯" },
    toast_ok: "Ø¢Ú¯Ù‡ÛŒ Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯. Ù¾Ø³ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ± Ù…Ù†ØªØ´Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
    cover: "Ú©Ø§ÙˆØ±",
    coverMake: "Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø§ÙˆØ±",
    del: "Ø­Ø°Ù",
    choose: "Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
    errors: {
      auth: "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´ÙˆÛŒØ¯.",
      title: "Ø¹Ù†ÙˆØ§Ù† Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª. (Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±)",
      desc: "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª. (Ø­Ø¯Ø§Ù‚Ù„ Û³Û° Ú©Ø§Ø±Ø§Ú©ØªØ±)",
      cat: "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.",
      sub: "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø²ÛŒØ± Ø¯Ø³ØªÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.",
      prov: "Ù„Ø·ÙØ§Ù‹ Ú©Ø´ÙˆØ± Ùˆ Ø§Ø³ØªØ§Ù†/Ù…Ù†Ø·Ù‚Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.",
      dist: "Ù„Ø·ÙØ§Ù‹ Ø´Ù‡Ø± ÛŒØ§ Ù†Ø§Ø­ÛŒÙ‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.",
      price: "Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û± Ù„ÛŒØ± ØªØ±Ú©ÛŒÙ‡ Ø¨Ø§Ø´Ø¯.",
      files: "Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ ØªØµÙˆÛŒØ± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.",
      filetype: "Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· ØªØµØ§ÙˆÛŒØ± Ø¨Ø§ ÙØ±Ù…Øª JPG ÛŒØ§ PNG ÛŒØ§ WebP Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯."
    }
  }
};

    const cats = [ /* ... AYNI ... */ ];
    const COUNTRY_REGIONS = {
  "TR": [
    "Adana","AdÄ±yaman","Afyonkarahisar","AÄŸrÄ±","Aksaray","Amasya","Ankara","Antalya","Ardahan",
    "Artvin","AydÄ±n","BalÄ±kesir","BartÄ±n","Batman","Bayburt","Bilecik","BingÃ¶l","Bitlis","Bolu",
    "Burdur","Bursa","Ã‡anakkale","Ã‡ankÄ±rÄ±","Ã‡orum","Denizli","DiyarbakÄ±r","DÃ¼zce","Edirne",
    "ElazÄ±ÄŸ","Erzincan","Erzurum","EskiÅŸehir","Gaziantep","Giresun","GÃ¼mÃ¼ÅŸhane","Hakkari",
    "Hatay","IÄŸdÄ±r","Isparta","Ä°stanbul","Ä°zmir","KahramanmaraÅŸ","KarabÃ¼k","Karaman","Kars",
    "Kastamonu","Kayseri","KÄ±rÄ±kkale","KÄ±rklareli","KÄ±rÅŸehir","Kilis","Kocaeli","Konya",
    "KÃ¼tahya","Malatya","Manisa","Mardin","Mersin","MuÄŸla","MuÅŸ","NevÅŸehir","NiÄŸde","Ordu",
    "Osmaniye","Rize","Sakarya","Samsun","Siirt","Sinop","Sivas","ÅanlÄ±urfa","ÅÄ±rnak","TekirdaÄŸ",
    "Tokat","Trabzon","Tunceli","UÅŸak","Van","Yalova","Yozgat","Zonguldak"
  ],

  "DE": [
    "Baden-WÃ¼rttemberg","Bayern","Berlin","Brandenburg","Bremen","Hamburg","Hessen",
    "Mecklenburg-Vorpommern","Niedersachsen","Nordrhein-Westfalen","Rheinland-Pfalz",
    "Saarland","Sachsen","Sachsen-Anhalt","Schleswig-Holstein","ThÃ¼ringen"
  ],

  "CY": [
    "GazimaÄŸusa","Girne","GÃ¼zelyurt","Ä°skele","Lefke","LefkoÅŸa"
  ],

  "IR": [
    "Ardabil","Azerbaycan-e Gharbi (BatÄ± Azerbaycan)","Azerbaycan-e Sharqi (DoÄŸu Azerbaycan)",
    "BuÅŸehr","Chaharmahal ve Bahtiyari","Elburz","Fars","Gilan","Golestan","Hamedan","Hormozgan",
    "Ilam","Ä°sfahan","Kerman","KermanÅŸah","Khorasan-e Jonoubi (GÃ¼ney Horasan)",
    "Khorasan-e Razavi (Razavi Horasan)","Khorasan-e Shomali (Kuzey Horasan)","Khuzestan",
    "Kohgiluyeh ve Buyer Ahmed","Kurdistan","Lorestan","Markazi","Mazandaran","Qazvin","Qom",
    "Semnan","Sistan ve Belucistan","Tahran","Yazd","Zanjan"
  ],

  "AZ": [
    "AbÅŸeron","AÄŸcabÉ™di","AÄŸdam","AÄŸdaÅŸ","AÄŸstafa","AÄŸsu","Astara","BabÉ™k","BakÄ±","BalakÉ™n",
    "BÉ™rdÉ™","BeylÉ™qan","BilÉ™suvar","CÉ™brayÄ±l","CÉ™lilabad","Culfa","DaÅŸkÉ™sÉ™n","FÃ¼zuli","GÉ™dÉ™bÉ™y",
    "GÉ™ncÉ™","Goranboy","GÃ¶ygÃ¶l","GÃ¶yÃ§ay","HacÄ±qabul","XaÃ§maz","XankÉ™ndi","XÄ±zÄ±","XocalÄ±",
    "XocavÉ™nd","Ä°miÅŸli","Ä°smayÄ±llÄ±","KÉ™lbÉ™cÉ™r","KÃ¼rdÉ™mir","LaÃ§Ä±n","LÉ™nkÉ™ran","Lerik","MasallÄ±",
    "MingÉ™Ã§evir","Naftalan","NeftÃ§ala","OÄŸuz","Ordubad","QÉ™bÉ™lÉ™","Qax","Qazax","Qobustan","Quba",
    "QubadlÄ±","Qusar","SaatlÄ±","Sabirabad","SÉ™dÉ™rÉ™k","Åabran","Åahbuz","ÅÉ™ki","ÅamaxÄ±",
    "ÅÉ™mkir","ÅÉ™rur","Åirvan","SiyÉ™zÉ™n","SumqayÄ±t","ÅuÅŸa","TÉ™rtÉ™r","Tovuz","Ucar","YardÄ±mlÄ±",
    "Yevlax","Zaqatala","ZÉ™ngilan","ZÉ™rdab"
  ]
};

    window.$ = (id)=> document.getElementById(id);
    function setLang(lng){
      const t = i18n[lng]||i18n.tr; document.documentElement.lang=lng; document.documentElement.dir=(lng==='ar')?'rtl':'ltr';
      $('t_title').textContent=t.title; $('t_sub').innerHTML=t.sub; $('t_lang').textContent=t.lang;
      $('l_title').textContent=t.l_title; $('h_title').textContent=t.h_title;
      $('l_description').textContent=t.l_description; $('h_description').textContent=t.h_description;
      $('l_category').textContent=t.l_category; $('l_subcategory').textContent=t.l_subcategory;
      $('l_country').textContent=t.l_country;
      $('l_province').textContent=t.l_province; $('l_district').textContent=t.l_district;
      $('l_price').textContent=t.l_price; $('l_stock').textContent=t.l_stock; $('l_images').textContent=t.l_images;
      $('b_cancel').textContent=t.btn_cancel; $('b_submit').textContent=t.btn_submit;
      $('title').placeholder=t.placeholders.title; $('description').placeholder=t.placeholders.desc; $('districtInput').placeholder=t.placeholders.district; $('price').placeholder=t.placeholders.price;
      const stock=$('stock'); stock.options[0].textContent=t.stock.var; stock.options[1].textContent=t.stock.yok;
      rebuildCategories(lng); fillProvinces(lng);
      window.__t = t; $('toast').textContent = t.toast_ok;
    }

    function rebuildCategories(lng){
      const selCat=$('category'); const selSub=$('subcategory');
      selCat.innerHTML = `<option value="" disabled selected>${i18n[lng].choose}</option>` +
        cats.map(c=>`<option value="${c.id}">${c.names[lng]||c.names.tr}</option>`).join('');
      selSub.disabled = true; selSub.innerHTML = `<option value="" disabled selected>${i18n[lng].choose}</option>`;
      selCat.onchange = ()=>{
        const c=cats.find(x=>x.id===selCat.value); selSub.disabled = !c;
        const idx = {tr:1,en:2,de:3,ar:4}[lng] || 1;
        selSub.innerHTML = `<option value="" disabled selected>${i18n[lng].choose}</option>` +
          (c? c.subs.map(s=>`<option value="${s[0]}">${s[idx]}</option>`).join('') : '');
      };
    }

    function fillProvinces(){
  const selProv   = $('province');
  const countryEl = $('country');
  const lng       = document.documentElement.lang || 'tr';
  const regions   = COUNTRY_REGIONS[countryEl.value] || [];
  const choose    = (i18n[lng] && i18n[lng].choose) || 'SeÃ§iniz';

  selProv.innerHTML =
    `<option value="" disabled selected>${choose}</option>` +
    regions.map(p => `<option value="${p}">${p}</option>`).join('');
}

    const inputEl = $('images');
    const previewsEl = $('previews');
    let __items = [];
    let __coverIndex = -1;

    function syncInputFromSelected(){
      const dt = new DataTransfer();
      __items.forEach(it=> dt.items.add(it.file));
      inputEl.files = dt.files;
    }

    function renderPreviews(){
      const t = window.__t || i18n.tr;
      previewsEl.innerHTML = '';
      __items.forEach((it, idx)=>{
        const box = document.createElement('div');
        box.className = 'thumb' + (idx===__coverIndex? ' coverSel':'');

        const img = document.createElement('img');
        img.alt = `${t.l_images} ${idx+1}`;
        img.src = it.dataUrl || 'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9CA3AF" font-family="Arial" font-size="12">No Preview</text></svg>');
        box.appendChild(img);

        if(idx===__coverIndex){
          const badge=document.createElement('div');
          badge.className='cover';
          badge.textContent=t.cover;
          box.appendChild(badge);
        }

        const btns = document.createElement('div');
        btns.className = 'btns';
        const bCover = document.createElement('button');
        bCover.type='button'; bCover.textContent = t.coverMake;
        bCover.onclick = (ev)=>{ ev.preventDefault(); __coverIndex = idx; renderPreviews(); };
        const bDel = document.createElement('button');
        bDel.type='button'; bDel.textContent = t.del;
        bDel.onclick = (ev)=>{ ev.preventDefault(); __items.splice(idx,1); if(__items.length===0){ __coverIndex=-1; } else if(__coverIndex===idx){ __coverIndex=0; } else if(__coverIndex>idx){ __coverIndex--; } syncInputFromSelected(); renderPreviews(); };
        btns.appendChild(bCover);
        btns.appendChild(bDel);
        box.appendChild(btns);

        previewsEl.appendChild(box);
      });
    }

    inputEl.addEventListener('change', ()=>{
      const files = Array.from(inputEl.files || []).slice(0,5);
      __items = [];
      if(files.length){ __coverIndex = 0; }
      let done = 0;
      files.forEach((f, i)=>{
        const fr = new FileReader();
        fr.onload = (e)=>{ __items[i] = { file: f, dataUrl: e.target.result }; done++; if(done===files.length) { syncInputFromSelected(); renderPreviews(); } };
        fr.onerror = ()=>{ __items[i] = { file: f, dataUrl: '' }; done++; if(done===files.length) { syncInputFromSelected(); renderPreviews(); } };
        fr.readAsDataURL(f);
      });
      if(files.length===0){ previewsEl.innerHTML=''; __coverIndex=-1; }
    });

    // BaÅŸlangÄ±Ã§ dili TR ve kapatma (index.html)
    const sel=$('langSel'); sel.value='tr'; setLang('tr');
    const closeBtn = $('closeBtn'); if(closeBtn){ closeBtn.onclick = ()=>{ window.location.href='/index.html'; }; }
    sel.addEventListener('change', ()=> setLang(sel.value));
    fillProvinces('tr'); rebuildCategories('tr');
    $('country').addEventListener('change', fillProvinces);

  })();
  </script>
   
  <!-- Firestore + BULUT (Cloudinary) yÃ¼kleme (aynen) -->
  <script type="module">
    const CLOUD_NAME    = 'dbntnzogo';
    const UPLOAD_PRESET = 'unsigned_avatars';
    const API_KEY       = '321492881526576';

    const app   = window.app   || window.firebaseApp;
    const auth  = window.auth  || (window.firebase && window.firebase.auth);
    const db    = window.db    || (window.firebase && window.firebase.db);

    function serverNow(){ return (window.firebase && window.firebase.serverTimestamp) ? window.firebase.serverTimestamp() : new Date(); }
    async function setDocX(path, data){
      if (window.firebase && window.firebase.setDoc) return window.firebase.setDoc(path, data);
      if (window._setDoc) return window._setDoc(path, data);
      throw new Error('setDoc fonksiyonu yok (firebase-init.js kontrol edin)');
    }
    function getAuthUser(){ return (auth && auth.currentUser) ? auth.currentUser : null; }

    async function uploadAllToCloud(uid, docId, files){
      const urls = [];
      if(!files || !files.length) return urls;
      const folder = `listings/${uid}/${docId}`;
      for (let i=0;i<files.length;i++){
        const f = files[i];
        const form = new FormData();
        form.append('file', f);
        form.append('upload_preset', UPLOAD_PRESET);
        form.append('folder', folder);

        const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
          method: 'POST', body: form
        });
        if(!res.ok){
          const txt = await res.text();
          throw new Error('Buluta yÃ¼kleme hatasÄ±: '+txt);
        }
        const json = await res.json();
        urls.push(json.secure_url || json.url);
      }
      return urls;
    }

    const $ = (id)=> document.getElementById(id);
    const form = $('listingForm');
    const msg  = $('msg');
    const toast = $('toast');

    function t(){ return (window.__t) || { errors:{}, toast_ok:'Kaydedildi.' }; }
    function showMsg(text, ok=false){ msg.style.color = ok ? 'var(--ok)' : '#6b7280'; msg.textContent = text; }
    function showToast(text){
      toast.textContent = text || t().toast_ok; toast.style.opacity = '1'; toast.style.transform = 'translateX(-50%) scale(1)';
      setTimeout(()=>{ toast.style.opacity='0'; toast.style.transform='translateX(-50%) scale(0.95)'; }, 1800);
    }
    function getCoverIndex(){
      const list = Array.from(document.querySelectorAll('#previews .thumb'));
      const i = list.findIndex(el => el.querySelector('.cover'));
      return (i >= 0 ? i : (list.length ? 0 : -1));
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const user = getAuthUser();
      if(!user){ showMsg(t().errors.auth || 'GiriÅŸ yapÄ±n.'); return; }

           const lang = document.documentElement.lang || 'tr';
      const country = $('country').value;
      const title = $('title').value.trim();
      const description = $('description').value.trim();
      const category = $('category').value;
      const subcategory = $('subcategory').value;
      const province = $('province').value;
      const district = $('districtInput').value.trim();
      const price = parseInt(($('price').value||'0'), 10) || 0;
      const stock = $('stock').value;

      if(title.length < 6){ showMsg(t().errors.title || 'BaÅŸlÄ±k kÄ±sa.'); return; }
      if(description.length < 30){ showMsg(t().errors.desc || 'AÃ§Ä±klama kÄ±sa.'); return; }
      if(!category){ showMsg(t().errors.cat || 'Kategori seÃ§in.'); return; }
      if(!subcategory){ showMsg(t().errors.sub || 'Alt kategori seÃ§in.'); return; }
      if(!country){ showMsg(t().errors.prov || 'Ãœlke seÃ§in.'); return; }
      if(!province){ showMsg(t().errors.prov || 'Ä°l seÃ§in.'); return; }
      if(!district){ showMsg(t().errors.dist || 'Ä°lÃ§e girin.'); return; }
      if(price < 1){ showMsg(t().errors.price || 'Fiyat en az 1.'); return; }

      const files = Array.from(($('images').files||[])).slice(0,5);
      if(files.length > 5){ showMsg(t().errors.files || 'En fazla 5 foto.'); return; }
      for(const f of files){ if(!/image\/(jpeg|png|webp)/i.test(f.type)){ showMsg(t().errors.filetype || 'Sadece JPG/PNG/WebP.'); return; } }

      const submitBtn = $('b_submit');
      submitBtn.disabled = true; submitBtn.textContent = 'Kaydediliyorâ€¦';
      showMsg('');

      try{
        const autoId = (window.crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now().toString(36)+Math.random().toString(36).slice(2,8));
        const docPath = `listings/${autoId}`;

        let photoURLs = [];
        try{ photoURLs = await uploadAllToCloud(user.uid, autoId, files); }
        catch(upErr){ console.warn('upload fail', upErr); showMsg('FotoÄŸraf yÃ¼kleme hatasÄ±: '+upErr.message); }

        const coverIndex = (getCoverIndex());
        const coverUrl = (photoURLs[coverIndex] || photoURLs[0] || '');

        const now = Date.now();
const THIRTY_DAYS = 30 * 24 * 60 * 60 * 1000;

const payload = {
  title, description, category, subcategory,
  country, province, district, price, stock,
  status: 'pending',
  showcase: false,
  showcasePending: false,

  // ğŸ”´ SÃœRELER
  expireAt: firebase.firestore.Timestamp.fromMillis(now + THIRTY_DAYS),
showcaseExpireAt: firebase.firestore.Timestamp.fromMillis(now + THIRTY_DAYS),

  photos: photoURLs,
  coverIndex: (coverIndex>=0?coverIndex:0),
  coverUrl: coverUrl,
  userId: user.uid,
  locale: lang,
  createdAt: serverNow(),
  updatedAt: serverNow()
};


        await setDocX(docPath, payload);

        showToast(t().toast_ok || 'Kaydedildi.');
        form.reset();
        setTimeout(()=>{ window.location.href = 'profile.html'; }, 900);
      }catch(err){
        console.error(err);
        showMsg('Kaydetme hatasÄ±: '+ (err && err.message ? err.message : err));
      }finally{
        submitBtn.disabled = false; submitBtn.textContent = (window.__t?.btn_submit) || 'Kaydet';
      }
    });

  </script>  
   const showcase = rows.filter(r => !!r.showcase);
    const standard = rows.filter(r => !r.showcase);
    allListings = [...showcase, ...standard];
    page = 0;
    render();
  } catch (err) {
    info.textContent = currentLang === 'en'
      ? 'Failed to load listings'
      : 'Ä°lanlar yÃ¼klenemedi';
    console.error(err);
  }
}

// Firebase hazÄ±r olduÄŸunda Ã§alÄ±ÅŸtÄ±r
if (self.__fbReady) {
  loadListings();
} else {
  document.addEventListener('fb-ready', loadListings, { once: true });
}

    // dil deÄŸiÅŸirse liste metinlerini yenile
    window.addEventListener('storage', (e)=>{ if(e.key==='ue_lang'){ currentLang = localStorage.getItem('ue_lang')||'tr'; render(); } });
  </script>
</body>
</html>  

